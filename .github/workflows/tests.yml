name: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–æ—Ç–∞

# –ö–æ–≥–¥–∞ –∑–∞–ø—É—Å–∫–∞—Ç—å
on:
  push:
    branches: [ main, master, develop ]  # –ü—Ä–∏ push –≤ —ç—Ç–∏ –≤–µ—Ç–∫–∏
  pull_request:
    branches: [ main, master ]  # –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ PR

# –ó–∞–¥–∞—á–∏
jobs:
  test:
    name: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ Windows
    runs-on: windows-latest  # Windows, –∫–∞–∫ —É –≤–∞—Å –ª–æ–∫–∞–ª—å–Ω–æ
    
    steps:
    # –®–∞–≥ 1: –°–∫–∞—á–∞—Ç—å –∫–æ–¥ –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
    - name: üì• –°–∫–∞—á–∞—Ç—å –∫–æ–¥
      uses: actions/checkout@v4
    
    # –®–∞–≥ 2: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Python 3.13
    - name: üêç –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Python 3.13
      uses: actions/setup-python@v5
      with:
        python-version: '3.13'
        cache: 'pip'  # –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å –ø–∞–∫–µ—Ç—ã –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏
    
    # –®–∞–≥ 3: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
    - name: üì¶ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
    
    # –®–∞–≥ 4: –°–æ–∑–¥–∞—Ç—å .env —Ñ–∞–π–ª –¥–ª—è —Ç–µ—Å—Ç–æ–≤ (–±–µ–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤)
    - name: üîê –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π .env
      run: |
        echo "BOT_TOKEN=test_token" > .env
        echo "PAYMENT_TOKEN=test_payment_token" >> .env
        echo "DATABASE_PATH=test_dianalisa_bot.db" >> .env
    
    # –®–∞–≥ 5: –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã –∫–ª–∞–≤–∏–∞—Ç—É—Ä
    - name: ‚å®Ô∏è –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä
      run: python test_all_buttons_auto.py
      continue-on-error: false  # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –µ—Å–ª–∏ —Ç–µ—Å—Ç—ã –ø—Ä–æ–≤–∞–ª–∏–ª–∏—Å—å
    
    # –®–∞–≥ 6: –ó–∞–ø—É—Å—Ç–∏—Ç—å edge case —Ç–µ—Å—Ç—ã
    - name: üîç –¢–µ—Å—Ç edge cases
      run: python test_edge_cases.py
      continue-on-error: false
    
    # –®–∞–≥ 7: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã –∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å
    - name: ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞
      run: |
        python -m py_compile bot.py
        python -m py_compile callbacks.py
        python -m py_compile database.py
        python -m py_compile keyboards.py
    
    # –®–∞–≥ 8: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤
    - name: üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤
      if: always()  # –í—Å–µ–≥–¥–∞ –≤—ã–ø–æ–ª–Ω—è—Ç—å, –¥–∞–∂–µ –µ—Å–ª–∏ —Ç–µ—Å—Ç—ã –ø—Ä–æ–≤–∞–ª–∏–ª–∏—Å—å
      run: |
        echo "========================================" 
        echo "–¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–û"
        echo "========================================"
        echo "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤—ã—à–µ –¥–ª—è –¥–µ—Ç–∞–ª–µ–π"
    
    # –®–∞–≥ 9: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–∏ –ø—Ä–æ–≤–∞–ª–µ
    - name: ‚ùå –¢–µ—Å—Ç—ã –ø—Ä–æ–≤–∞–ª–∏–ª–∏—Å—å
      if: failure()
      run: |
        echo "::error::–¢–ï–°–¢–´ –ù–ï –ü–†–û–®–õ–ò! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤—ã—à–µ."
        echo "::error::–î–µ–ø–ª–æ–π –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –¥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–æ–∫."
        exit 1
    
    # –®–∞–≥ 10: –£—Å–ø–µ—à–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ
    - name: ‚úÖ –¢–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã
      if: success()
      run: |
        echo "::notice::–í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!"
        echo "::notice::–ö–æ–¥ –≥–æ—Ç–æ–≤ –∫ –¥–µ–ø–ª–æ—é."


