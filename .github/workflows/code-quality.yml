name: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞

on:
  push:
    branches: [ main, master, develop ]
  pull_request:
    branches: [ main, master ]

jobs:
  quality:
    name: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞
    runs-on: ubuntu-latest
    
    steps:
    - name: üì• –°–∫–∞—á–∞—Ç—å –∫–æ–¥
      uses: actions/checkout@v4
    
    - name: üêç –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.13'
    
    - name: üì¶ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
      run: |
        pip install flake8 pylint
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –∏ undefined names
    - name: üîç Flake8 - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞
      run: |
        # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–±–æ—Ä–∫—É –µ—Å–ª–∏ –µ—Å—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏
        flake8 . --count --select=E9,F63,F7,F82 --show-source --statistics
        # –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ (–Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç)
        flake8 . --count --exit-zero --max-complexity=10 --max-line-length=127 --statistics
      continue-on-error: true
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–æ–≤
    - name: üìè –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–æ–≤
      run: |
        echo "–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤ (>500 —Å—Ç—Ä–æ–∫):"
        find . -name "*.py" -type f -exec wc -l {} \; | awk '$1 > 500 {print "‚ö†Ô∏è –ë–û–õ–¨–®–û–ô –§–ê–ô–õ: "$2" ("$1" —Å—Ç—Ä–æ–∫)"}'
    
    # –ü–æ–¥—Å—á–µ—Ç —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∫—Ä—ã—Ç–∏—è
    - name: üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
      run: |
        echo "==================================="
        echo "üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ü–†–û–ï–ö–¢–ê"
        echo "==================================="
        echo "Python —Ñ–∞–π–ª—ã:"
        find . -name "*.py" -type f | wc -l
        echo ""
        echo "–í—Å–µ–≥–æ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞:"
        find . -name "*.py" -type f -exec wc -l {} \; | awk '{sum+=$1} END {print sum}'
        echo ""
        echo "–¢–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã:"
        find . -name "test_*.py" -type f | wc -l
        echo "==================================="


