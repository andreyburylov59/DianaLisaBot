name: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π

# –ó–∞–ø—É—Å–∫–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —É—Å–ø–µ—à–Ω—ã—Ö —Ç–µ—Å—Ç–∞—Ö –Ω–∞ main –≤–µ—Ç–∫–µ
on:
  workflow_run:
    workflows: ["–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–æ—Ç–∞"]
    types:
      - completed
    branches: [main, master]

jobs:
  deploy:
    name: –î–µ–ø–ª–æ–π –±–æ—Ç–∞
    runs-on: ubuntu-latest
    # –î–µ–ø–ª–æ–∏—Ç—å –¢–û–õ–¨–ö–û –µ—Å–ª–∏ —Ç–µ—Å—Ç—ã –ø—Ä–æ—à–ª–∏
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    
    steps:
    - name: üì• –°–∫–∞—á–∞—Ç—å –∫–æ–¥
      uses: actions/checkout@v4
    
    - name: ‚úÖ –¢–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã
      run: |
        echo "‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!"
        echo "üöÄ –ì–æ—Ç–æ–≤ –∫ –¥–µ–ø–ª–æ—é..."
    
    # –í–ê–†–ò–ê–ù–¢ 1: –î–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ SSH (–µ—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä)
    # –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
    # - name: üöÄ –î–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä —á–µ—Ä–µ–∑ SSH
    #   uses: appleboy/ssh-action@master
    #   with:
    #     host: ${{ secrets.SERVER_HOST }}
    #     username: ${{ secrets.SERVER_USER }}
    #     key: ${{ secrets.SSH_PRIVATE_KEY }}
    #     script: |
    #       cd /path/to/bot
    #       git pull
    #       pip install -r requirements.txt
    #       systemctl restart dianalisa-bot
    
    # –í–ê–†–ò–ê–ù–¢ 2: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ –¥–µ–ø–ª–æ—é
    - name: üì¢ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
      run: |
        echo "::notice::‚úÖ –ö–æ–¥ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –¥–µ–ø–ª–æ—é!"
        echo "::notice::–ó–∞–ø—É—Å—Ç–∏—Ç–µ –¥–µ–ø–ª–æ–π –≤—Ä—É—á–Ω—É—é –∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π."
    
    # –í–ê–†–ò–ê–ù–¢ 3: –°–æ–∑–¥–∞—Ç—å Release
    - name: üéâ –°–æ–∑–¥–∞—Ç—å —Ä–µ–ª–∏–∑
      if: startsWith(github.ref, 'refs/tags/')
      uses: actions/create-release@v1
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        tag_name: ${{ github.ref }}
        release_name: Release ${{ github.ref }}
        body: |
          ## –ò–∑–º–µ–Ω–µ–Ω–∏—è
          - –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã ‚úÖ
          - –ì–æ—Ç–æ–≤ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É
        draft: false
        prerelease: false


